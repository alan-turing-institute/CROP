{% extends "base_site.html" %}

{% block title %} EDIT SENSOR {% endblock title %}

{% block content %}
<div class="right_col" role="main">
  <div class="">
    <div class="page-title">
      <div class="title_left">
        <h3>Edit sensor #{{ sensor_id }}</h3>
      </div>
    </div>

    <div class="clearfix"></div>

    <div class="row">
      <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">

          <div class="x_content">
            <h3 id="header">Attributes</h3>
            <form
                id="attributes_form"
                data-parsley-validate
                class="form-horizontal form-label-left"
                method="POST">

              <!-- hidden -->
              <div class="form-group">
                <input
                    type="hidden"
                    id="form_name"
                    name="form_name"
                    value="attributes_form">
              </div>
              <div class="form-group">
                <input
                    type="hidden"
                    id="id"
                    name="id"
                    value="{{ sensor_id }}">
              </div>
              <!-- /hidden -->

              <div class="form-group">
                <label
                    class="control-label col-md-3 col-sm-3 col-xs-12"
                    for="type_id">
                  Sensor type
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <select
                       id="type_id"
                       name="type_id"
                       class="form-control selectpicker col-md-7 col-xs-12"
                       >
                    {% for type in sensor_types %}
                    <option
                        value={{ type.id }}
                        {% if type.id == sensor.type_id %} selected {% endif %}
                    >
                    {{ type.sensor_type }}
                    </option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label
                    class="control-label col-md-3 col-sm-3 col-xs-12"
                    for="name">
                  Name
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input
                      type="text"
                      id="name"
                      name="name"
                      class="form-control col-md-7 col-xs-12"
                      value="{{ sensor.name }}">
                </div>
              </div>


              <div class="form-group">
                <label
                    class="control-label col-md-3 col-sm-3 col-xs-12"
                    for="device_id">
                  Device ID
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input
                      type="text"
                      id="device_id"
                      name="device_id"
                      class="form-control col-md-7 col-xs-12"
                      value="{{ sensor.device_id }}">
                </div>
              </div>

              <div class="form-group">
                <label
                    class="control-label col-md-3 col-sm-3 col-xs-12"
                    for="aranet_code">
                  Aranet code
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input
                      type="text"
                      id="aranet_code"
                      name="aranet_code"
                      class="form-control col-md-7 col-xs-12"
                      value="{{ sensor.aranet_code }}">
                </div>
              </div>

              <div class="form-group">
                <label
                    class="control-label col-md-3 col-sm-3 col-xs-12"
                    for="aranet_pro_id">
                  Aranet Pro ID
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input
                      type="text"
                      id="aranet_pro_id"
                      name="aranet_pro_id"
                      class="form-control col-md-7 col-xs-12"
                      value="{{ sensor.aranet_pro_id }}">
                </div>
              </div>

              <div class="form-group">
                <label
                    class="control-label col-md-3 col-sm-3 col-xs-12"
                    for="serial_number">
                  Serial number
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input
                      type="text"
                      id="serial_number"
                      name="serial_number"
                      class="form-control col-md-7 col-xs-12"
                      value="{{ sensor.serial_number }}">
                </div>
              </div>

              <div>
                <input type="submit" value="Submit">
              </div>
            </form>
          </div>

          <div class="x_content">
            <h3 id="header">Locations</h3>
            <table
                id="datatable-responsive"
                class="table table-striped table-bordered dt-responsie nowrap"
                cellspacing="0"
                width="100%">
              <thead>
                <tr>
                  <th>Installation Date</th>
                  <th>Location ID</th>
                  <th>Zone</th>
                  <th>Aisle</th>
                  <th>Column</th>
                  <th>Shelf</th>
                </tr>
              </thead>

              <tbody>
                {% for t_sensor_loc in sensor_locations %}
                <tr class='clickable-row' method = POST>
                  <td>{{ t_sensor_loc.installation_date }}</td>
                  <td>{{ t_sensor_loc.location_id }}</td>
                  <td>{{ t_sensor_loc.zone }}</td>
                  <td>{{ t_sensor_loc.aisle }}</td>
                  <td>{{ t_sensor_loc.column }}</td>
                  <td>{{ t_sensor_loc.shelf }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>

            <form
                id="add_location_form"
                data-parsley-validate
                class="form-horizontal form-label-left"
                method="POST">

              <!-- hidden -->
              <div class="form-group">
                <input
                    type="hidden"
                    id="form_name"
                    name="form_name"
                    value="add_location_form">
              </div>
              <div class="form-group">
                <input
                    type="hidden"
                    id="id"
                    name="id"
                    value="{{ sensor_id }}">
              </div>
              <!-- /hidden -->

              <div class="form-group">
                <label
                    class="control-label col-md-3 col-sm-3 col-xs-12"
                    for="location_id">
                  New location
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <select
                      id="location_id"
                      name="location_id"
                      class="form-control selectpicker col-md-7 col-xs-12"
                      >
                      {% for loc in locs %}
                      <option
                          value={{ loc.id }}
                          {% if sensor_locations and loc.id == sensor_locations[0].location_id  %} selected {% endif %}
                          >
                          {{ loc.zone }}, {{ loc.aisle }}-{{ loc.column }}-{{ loc.shelf }}
                      </option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label
                    class="control-label col-md-3 col-sm-3 col-xs-12"
                    for="installation_date">
                  Installation date
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input
                      type="text"
                      name="installation_date"
                      value="{{latest_installation_date}}"
                      />
                </div>
              </div>

              <div>
                <input type="submit" value="Add installation">
              </div>
            </form>

          </div>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock content %}

{% block javascripts %}
{{ super()}}
<!-- Parsley -->
<script src="{{ url_for('static', filename='vendors/parsleyjs/dist/parsley.min.js') }}"></script>
<!-- Date picker -->
<script>
$(function() {
  $('input[name="installation_date"]').daterangepicker({
    singleDatePicker: true,
    showDropdowns: true,
    minDate: {{ latest_installation_date }},
    maxYear: parseInt(moment().format('YYYY'), 10),
    locale: {
      "format": "YYYY-MM-DD",
    }
  });
});
</script>
{% endblock javascripts %}
