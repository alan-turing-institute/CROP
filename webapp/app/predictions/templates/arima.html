{% extends "base_site.html" %}

{% block title %} ARIMA PREDICTIONS {% endblock title %}

{% block stylesheets %}
{{ super() }}
<link href="{{ url_for('static', filename='vendors/datatables.net-bs/css/dataTables.bootstrap.min.css') }}"
  rel="stylesheet">
<link href="{{ url_for('static', filename='vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css') }}"
  rel="stylesheet">
<link href="{{ url_for('static', filename='vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css') }}"
  rel="stylesheet">
<link href="{{ url_for('static', filename='vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css') }}"
  rel="stylesheet">
<link href="{{ url_for('static', filename='vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css') }}"
  rel="stylesheet">
<link href="{{ url_for('static', filename='css/predictions.css') }}" rel="stylesheet">
{% endblock stylesheets %}

{% block content %}
<div class="right_col" role="main">
  <div class="">

    <div class="row">
      <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">
          <div class="x_title">
            <h2>Arima: Temperature predictions</h2>
            <ul class="nav navbar-right panel_toolbox">
              <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
              </li>
            </ul>
            <div class="clearfix"></div>
          </div>

          <div class="x_content">
            <div class="" role="tabpanel" data-example-id="togglable-tabs">
              <div id="myTabContent" class="tab-content">
                <div role="tabpanel" class="tab-pane fade active in" id="tab_content0">
                  <div class="x_content">
                    <h4> <p id="arima_model0title"></p></h4>
                    <div class="canvas_wrapper">
                      <canvas id="arima_model0"></canvas>
                    </div>
                    <h4> <p id="arima_model1title"></p></h4>
                    <div class="canvas_wrapper">
                      <canvas id="arima_model1"></canvas>
                    </div>
                    <h4> <p id="arima_model2title"></p></h4>
                    <div class="canvas_wrapper">
                      <canvas id="arima_model2"></canvas>
                    </div>
                    <p class="text-muted font-13 m-b-30"></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block javascripts %}
{{ super() }}
<!-- Datatables -->

<script src="{{ url_for('static', filename='javascript/predictions.js') }}"></script>
<script src="{{ url_for('static', filename='javascript/utility.js') }}"></script>
<script src="{{ url_for('static', filename='vendors/datatables.net/js/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendors/datatables.net-bs/js/dataTables.bootstrap.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendors/datatables.net-buttons/js/dataTables.buttons.min.js') }}"></script>
<script
  src="{{ url_for('static', filename='vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendors/datatables.net-buttons/js/buttons.flash.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendors/datatables.net-buttons/js/buttons.html5.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendors/datatables.net-buttons/js/buttons.print.min.js') }}"></script>
<script
  src="{{ url_for('static', filename='vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js') }}"></script>
<script
  src="{{ url_for('static', filename='vendors/datatables.net-keytable/js/dataTables.keyTable.min.js') }}"></script>
<script
  src="{{ url_for('static', filename='vendors/datatables.net-responsive/js/dataTables.responsive.min.js') }}"></script>
<script
  src="{{ url_for('static', filename='vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js') }}"></script>
<script
  src="{{ url_for('static', filename='vendors/datatables.net-scroller/js/dataTables.scroller.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendors/jszip/dist/jszip.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendors/pdfmake/build/pdfmake.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendors/pdfmake/build/vfs_fonts.js') }}"></script>
<!-- Chart.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.8.0/chart.min.js" integrity="sha512-sW/w8s4RWTdFFSduOTGtk4isV1+190E/GghVffMA9XczdJ2MDzSzLEubKAs5h0wzgSJOQTRYyaz73L3d6RtJSg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@^2"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@^1"></script>

<script>
  function sensor_loop(json_arima, trh_data_dict ) {
    //get unique sensor ids
    list_sensors = []
    for (var i = 0; i < json_arima.length; i++){
      list_sensors.push(json_arima[i]["sensor_id"])
    }
    let unique_sensors = [...new Set(list_sensors)];
    
    for (var i = 0; i < unique_sensors.length; i++) {
      json_arima_sensor = []
      for (var j = 0; j < json_arima.length; j++) {
        if (json_arima[j]["sensor_id"] == unique_sensors[i])
        {
          var current_sensor =  unique_sensors[i]
          json_arima_sensor.push(json_arima[j]);
        }
      }
      //title
      const canvasname = "arima_model"+[i]
      const title = "sensor id: " + current_sensor + "     |   " + "run id: " + json_arima[i]["Values"][0]["run_id"];
      document.getElementById(canvasname+"title").innerHTML = title
      // See static/javascript/predictions.js for the plot function.
      const show_legend = i == 0
      const axis_title = "Temperature (Â°C)"
      plot(json_arima_sensor[2], json_arima_sensor[1], json_arima_sensor[0], null, trh_data_dict[String(current_sensor)], "temperature", canvasname, axis_title, show_legend, null);
    }
  }

  var arima_data = JSON.parse('{{json_arima_f | safe}}');
  var trh_data = JSON.parse('{{json_trh_f | safe}}');
  var trh_data_18 = JSON.parse('{{json_trh_18_f | safe}}');
  var trh_data_23 = JSON.parse('{{json_trh_23_f | safe}}');
  var trh_data_27 = JSON.parse('{{json_trh_27_f | safe}}');
  // TODO The trh data format is a redundant, all the three elements
  //  actually hold all the data. Sort this out.
  const trh_data_dict = {18: trh_data_18, 23: trh_data_23, 27:trh_data_27}
  sensor_loop(arima_data, trh_data_dict)
</script>



{% endblock javascripts %}
